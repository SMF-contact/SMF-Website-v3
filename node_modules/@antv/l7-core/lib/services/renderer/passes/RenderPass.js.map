{"version":3,"sources":["../../../../src/services/renderer/passes/RenderPass.ts"],"names":["RenderPass","PassType","Normal","layer","config","rendererService","useFramebuffer","clear","readFBO","multiPassRenderer","getPostProcessor","getReadFBO","color","depth","stencil","framebuffer","setRenderFlag","models","forEach","model","draw","uniforms","layerModel","getUninforms","BaseNormalPass"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AAEA;;AACA;;;;;;;;IAMqBA,U,WADpB,4B;;;;;;;;;;;;WAIC,mBAAiB;AACf,aAAOC,6BAASC,MAAhB;AACD;;;WAED,mBAAiB;AACf,aAAO,QAAP;AACD;;;WAED,cAAYC,KAAZ,EAA2BC,MAA3B,EAAoE;AAClE,uGAAWD,KAAX,EAAkBC,MAAlB;AACD;;;WAED,gBAAcD,KAAd,EAA6B;AAC3B,kCAAkC,KAAKE,eAAvC;AAAA,UAAQC,cAAR,yBAAQA,cAAR;AAAA,UAAwBC,KAAxB,yBAAwBA,KAAxB;AACA,UAAMC,OAAO,GAAGL,KAAK,CAACM,iBAAN,CAAwBC,gBAAxB,GAA2CC,UAA3C,EAAhB;AACAL,MAAAA,cAAc,CAACE,OAAD,EAAU,YAAM;AAC5BD,QAAAA,KAAK,CAAC;AACJK,UAAAA,KAAK,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CADH;AAEJC,UAAAA,KAAK,EAAE,CAFH;AAGJC,UAAAA,OAAO,EAAE,CAHL;AAIJC,UAAAA,WAAW,EAAEP;AAJT,SAAD,CAAL;AAOAL,QAAAA,KAAK,CAACM,iBAAN,CAAwBO,aAAxB,CAAsC,KAAtC;AAGAb,QAAAA,KAAK,CAACc,MAAN,CAAaC,OAAb,CAAqB,UAACC,KAAD,EAAW;AAC9BA,UAAAA,KAAK,CAACC,IAAN,CAAW;AACTC,YAAAA,QAAQ,EAAElB,KAAK,CAACmB,UAAN,CAAiBC,YAAjB;AADD,WAAX;AAGD,SAJD;AAMApB,QAAAA,KAAK,CAACM,iBAAN,CAAwBO,aAAxB,CAAsC,IAAtC;AACD,OAlBa,CAAd;AAmBD;;;EAnCOQ,wB","sourcesContent":["import { injectable } from 'inversify';\nimport 'reflect-metadata';\nimport { ILayer } from '../../layer/ILayerService';\nimport { PassType } from '../IMultiPassRenderer';\nimport BaseNormalPass from './BaseNormalPass';\n\n/**\n * RenderPass，负责输出到后续 PostProcessor 的 readFBO 中\n */\n@injectable()\nexport default class RenderPass<\n  InitializationOptions = {}\n> extends BaseNormalPass<InitializationOptions> {\n  public getType() {\n    return PassType.Normal;\n  }\n\n  public getName() {\n    return 'render';\n  }\n\n  public init(layer: ILayer, config?: Partial<InitializationOptions>) {\n    super.init(layer, config);\n  }\n\n  public render(layer: ILayer) {\n    const { useFramebuffer, clear } = this.rendererService;\n    const readFBO = layer.multiPassRenderer.getPostProcessor().getReadFBO();\n    useFramebuffer(readFBO, () => {\n      clear({\n        color: [0, 0, 0, 0],\n        depth: 1,\n        stencil: 0,\n        framebuffer: readFBO,\n      });\n      // render to post processor\n      layer.multiPassRenderer.setRenderFlag(false);\n      // layer.render();\n\n      layer.models.forEach((model) => {\n        model.draw({\n          uniforms: layer.layerModel.getUninforms(),\n        });\n      });\n\n      layer.multiPassRenderer.setRenderFlag(true);\n    });\n  }\n}\n"],"file":"RenderPass.js"}